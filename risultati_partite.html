<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Risultato Partita</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Manrope:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#000; --panel:#0A0A0A; --card:#111; --card-2:#141b2e; --border:#243255;
      --accent:#8AB4F8; --accent-2:#a3d3ff; --muted:#ccc; --muted-2:#999; --row:#15213b;
    }
    *{box-sizing:border-box}
    body { margin: 0; font-family: 'Manrope', sans-serif; background: var(--bg); color: #fff; }
    .container { max-width: 1200px; margin: 0 auto; background: var(--panel); padding: 32px; display: flex; flex-direction: row; gap: 32px; }
    .left-panel { flex: 2; }
    .right-panel { flex: 1; display: flex; flex-direction: column; gap: 24px; }
    #header-container { position: sticky; top: 0; z-index: 1000; background-color: #090909; width: 100%; }
    .card { background: var(--card); border-radius: 12px; overflow: hidden; color: #fff; box-shadow: 0 0 10px rgba(138, 180, 248, 0.2); transition: transform 0.3s ease; }
    .card:hover { transform: translateY(-2px); }
    .card-content { padding: 16px; }
    .card-title { font-family: 'Bebas Neue', sans-serif; font-size: 22px; color: var(--accent); letter-spacing: 0.5px; margin-bottom: 8px; }
    .card-text { font-size: 14px; color: var(--muted); }
    .teams { display: flex; justify-content: space-between; align-items: center; background: var(--card); padding: 16px; border-radius: 12px; margin-bottom: 24px; }
    .team { display: flex; flex-direction: column; align-items: center; text-align: center; }
    .team-avatar { width: 64px; height: 64px; border-radius: 50%; margin-bottom: 8px; display: grid; place-items: center; background: var(--card-2); border: 1px solid var(--border); font-family: 'Bebas Neue', sans-serif; font-size: 24px; color: var(--accent); letter-spacing: 1px; text-transform: uppercase; }
    .team-name { font-size: 16px; font-weight: 600; color: #fff; }
    .score { font-family: 'Bebas Neue', sans-serif; font-size: 48px; font-weight: 700; color: var(--accent); text-align:center; }
    .final { font-size: 14px; color: var(--muted-2); text-align: center; }
    .stats { background: var(--card); border-radius: 10px; overflow: hidden; }
    .stats-row { display: flex; padding: 12px 8px; border-bottom: 1px solid #222; align-items:center; }
    .stats-row:last-child { border-bottom: none; }
    .stat-name { flex: 2; font-size: 14px; display: flex; gap: 8px; align-items: center; }
    .badge-num { font-family: 'Bebas Neue', sans-serif; font-size: 14px; background: var(--row); border: 1px solid var(--border); color: var(--accent); border-radius: 6px; padding: 2px 6px; min-width: 28px; text-align: center; }
    .stat { flex: 1; text-align: center; font-size: 14px; }
    .header { background: var(--row); font-weight: 700; user-select:none; }
    .header .stat, .header .stat-name { cursor: pointer; position: relative; }
    .header .sort-indicator { margin-left: 6px; font-size: 12px; opacity: .9; }
    .error { margin-top: 16px; padding: 12px 16px; border: 1px solid #442222; background: #1a0e0e; color: #ffb3b3; border-radius: 8px; }

    /* ---------- Riepilogo squadre (fix proporzioni + score in linea) ---------- */
    .summary-card {
      background:
        radial-gradient(1200px 400px at 100% -10%, rgba(138,180,248,.08), transparent 60%),
        radial-gradient(1200px 400px at -10% 110%, rgba(138,180,248,.08), transparent 60%),
        rgba(17,17,17,.92);
      border: 1px solid rgba(138,180,248,.15);
      backdrop-filter: blur(8px);
      border-radius: 14px;
    }
    .summary-header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:16px 16px 4px 16px; flex-wrap:nowrap;
      white-space:nowrap; /* evita a capo */
    }
    .summary-team{
      display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.3px;
      min-width:0; flex:1 1 0;
    }
    .summary-team .team-badge{
      background: var(--card-2); border:1px solid var(--border); color: var(--accent);
      padding:6px 10px; border-radius:10px; font-family:'Bebas Neue', sans-serif; font-size:16px; flex:0 0 auto;
    }
    .summary-team-name{
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }
    .summary-score{
      font-family:'Bebas Neue', sans-serif; font-size:32px; color: var(--accent-2);
      flex:0 0 auto; white-space:nowrap;
    }
    .summary-grid{
      display:grid; grid-template-columns: 1fr; gap:10px; padding: 10px 16px 16px 16px;
    }
    .metric{
      display:grid; grid-template-columns: 120px 1fr 80px; gap:10px; align-items:center;
      font-size:13px;
    }
    .metric .label{ color:#ddd; }
    .bars{
      display:flex; height:18px; background:#0f1322; border:1px solid #1c2741; border-radius:999px; overflow:hidden;
    }
    .bar{ height:100%; }
    .bar-a{ background: linear-gradient(90deg, #6ea7ff, #8ab4f8); }
    .bar-b{ background: linear-gradient(90deg, #7ce7c7, #9cf0df); }
    .metric .value{ text-align:right; color:#dfe9ff; font-variant-numeric: tabular-nums; }
    .hint{ color:var(--muted-2); font-size:12px; margin: 4px 16px 12px 16px; }

    /* ---------- Article & Video cards ---------- */
    .foot-cards { display:flex; flex-direction:column; gap:12px; margin-top:6px; }
    .news-card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
      border: 1px solid rgba(138,180,248,0.08);
      border-radius: 12px;
      overflow: hidden;
      display:flex; gap:12px; align-items:center;
      padding:12px;
    }
    .news-thumb { width:72px; height:72px; border-radius:8px; background:#0f1322; display:grid; place-items:center; font-weight:700; color:var(--accent); font-family:'Bebas Neue'; }
    .news-thumb svg { width:44px; height:44px; display:block; }
    .news-body { flex:1; min-width:0; }
    .news-title { font-weight:700; color:var(--accent); font-family:'Bebas Neue'; font-size:16px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .news-desc { font-size:13px; color:var(--muted); overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; }
    .news-cta { margin-left: 8px; flex:0 0 auto; }
    .btn { background:transparent; border:1px solid rgba(138,180,248,0.15); padding:8px 10px; border-radius:8px; color:var(--accent); text-decoration:none; font-weight:700; font-size:13px; display:inline-block; }
    @media (max-width: 768px) {
      .container { flex-direction: column; }
      .right-panel { order: 2; }
      .left-panel { order: 1; }
      .metric{ grid-template-columns: 1fr; gap:6px; }
      .metric .value{ text-align:left; }
      .foot-cards { flex-direction:column; }
    }
  </style>
</head>
<body>
  <div id="header-container"></div>

  <div class="container">
    <div class="left-panel">
      <div class="teams">
        <div class="team" id="team1"></div>
        <div>
          <div class="score" id="score"></div>
          <div class="final" id="final"></div>
        </div>
        <div class="team" id="team2"></div>
      </div>

      <div class="stats">
        <div class="stats-row header" id="stats-header">
          <div class="stat-name" data-key="name" role="button" tabindex="0">
            Giocatore <span class="sort-indicator" aria-hidden="true"></span>
          </div>
          <div class="stat" data-key="min" role="button" tabindex="0">
            MIN <span class="sort-indicator" aria-hidden="true"></span>
          </div>
          <div class="stat" data-key="pts" role="button" tabindex="0">
            PTS <span class="sort-indicator" aria-hidden="true"></span>
          </div>
          <div class="stat" data-key="reb" role="button" tabindex="0">
            REB <span class="sort-indicator" aria-hidden="true"></span>
          </div>
          <div class="stat" data-key="asst" role="button" tabindex="0">
            AST <span class="sort-indicator" aria-hidden="true"></span>
          </div>
        </div>
        <div id="players-stats" aria-live="polite"></div>
      </div>

      <div id="error-box" class="error" style="display:none"></div>
    </div>

    <div class="right-panel" id="right-panel"></div>
  </div>

  <div id="footer-container"></div>

  <script>
    /* Header dinamico */
    fetch('https://raw.githubusercontent.com/sverza/Brewers/main/widget/brewers_header.html')
      .then(r => r.text())
      .then(html => document.getElementById('header-container').innerHTML = html)
      .catch(()=>{ /* silenzioso */ });

    /* Footer dinamico */
    fetch('https://raw.githubusercontent.com/sverza/Brewers/main/widget/brewers_footer.html')
      .then(r => r.text())
      .then(html => document.getElementById('footer-container').innerHTML = html)
      .catch(()=>{ /* silenzioso */ });

    /* ---------- Helper robusti ---------- */
    const toTitle = str => String(str ?? '')
      .replace(/_/g, ' ').replace(/\s+/g, ' ').trim()
      .replace(/\b\w/g, c => c.toUpperCase());

    const toNum = v => {
      if (v === null || v === undefined) return null;
      if (typeof v === 'number') return Number.isFinite(v) ? v : null;
      if (typeof v === 'string') {
        const s = v.trim();
        if (s === '' || s === '-' || s.toLowerCase() === 'nan') return null;
        const n = Number(s.replace(/[%+]/g, ''));
        return Number.isFinite(n) ? n : null;
      }
      return null;
    };

    const fmt = v => {
      const n = toNum(v);
      return (n === null) ? '-' : n;
    };

    const sumReb = r => {
      const o = toNum(r?.oreb);
      const d = toNum(r?.dreb);
      if (o === null && d === null) return '-';
      return (o ?? 0) + (d ?? 0);
    };

    const initials = name => String(name || '')
      .replace(/[^\p{L}\p{N}\s]/gu, ' ')
      .split(/\s+/).filter(Boolean).map(w => w[0]).slice(0,3).join('').toUpperCase();

    const teamAvatarHTML = name => `<div class="team-avatar">${initials(name)}</div>`;

    const showError = msg => {
      const b = document.getElementById('error-box');
      b.textContent = msg; b.style.display = 'block';
    };

    function pctFromMadeAtt(str){
      if(!str || typeof str !== 'string') return null;
      const m = str.match(/^\s*(\d+)\s*-\s*(\d+)\s*$/);
      if(!m) return null;
      const made = Number(m[1]), att = Number(m[2]);
      if(!att) return 0;
      return (made/att)*100;
    }

    /* ---------- Stato sorting ---------- */
    const sortState = { key: 'min', dir: 'desc' };
    let PLAYERS = [];
    let TEAM_A = null, TEAM_B = null;
    let NAME_A = 'Brewers', NAME_B = 'Opponent';

    /* ---------- Caricamento ---------- */
    const partita = new URLSearchParams(window.location.search).get("partita");
    if (!partita) {
      showError("Parametro 'partita' mancante nell’URL.");
    } else {
      const jsonUrl = `https://raw.githubusercontent.com/sverza/Brewers/main/partite/${encodeURIComponent(partita)}.json`;
      fetch(jsonUrl)
        .then(r => { if (!r.ok) throw new Error(`Errore HTTP ${r.status}`); return r.json(); })
        .then(data => {
          if (!Array.isArray(data)) throw new Error("Formato JSON non valido (atteso un array).");
          const players = data.filter(r => typeof r?.Number === 'number');
          const teamRows = data.filter(r => typeof r?.Number !== 'number');

          const brewers = teamRows.find(r => String(r["Player ID"] || '').toLowerCase().includes('brewers')) || teamRows[0];
          const opp = teamRows.find(r => r !== brewers) || teamRows[1];

          TEAM_A = brewers || null; TEAM_B = opp || null;
          NAME_A = TEAM_A ? String(TEAM_A["Player ID"]) : 'Brewers';
          NAME_B = TEAM_B ? String(TEAM_B["Player ID"]) : 'Opponent';

          const ptsA = TEAM_A ? toNum(TEAM_A.pts) : null;
          const ptsB = TEAM_B ? toNum(TEAM_B.pts) : null;

          document.getElementById("team1").innerHTML = `${teamAvatarHTML(NAME_A)}<div class="team-name">${NAME_A}</div>`;
          document.getElementById("team2").innerHTML = `${teamAvatarHTML(NAME_B)}<div class="team-name">${NAME_B}</div>`;
          document.getElementById("score").textContent = `${(ptsA ?? '-')} - ${(ptsB ?? '-')}`;
          document.getElementById("final").textContent = "Finale";

          /* Escludi chi ha 0 minuti */
          PLAYERS = players.map(p => ({
              ...p,
              _name: toTitle(p["Player ID"]),
              _reb: sumReb(p),
              _min: toNum(p.min),
              _pts: toNum(p.pts),
              _asst: toNum(p.asst),
              _num: toNum(p.Number)
            }))
            .filter(p => (p._min ?? 0) > 0); // <-- filtro MIN > 0

          renderPlayers();
          renderSummaryCard();
          setupSortingUI();

          // dopo aver renderizzato il riepilogo tentiamo di caricare le card articolo/video
          const datePrefix = extractDatePrefixFromMatchData(data);
          if (datePrefix) {
            renderArticleVideoCards(datePrefix);
          } else {
            // tenta comunque con la variabile 'partita' se ha prefisso numerico YYYYMMDD
            const maybe = (partita || '').match(/^(\d{8})/);
            if (maybe) renderArticleVideoCards(maybe[1]);
          }
        })
        .catch(err => showError(`Impossibile caricare il file: ${err.message}`));
    }

    /* ---------- Tabella giocatori ---------- */
    function getComparable(p, key){
      switch(key){
        case 'name': return p._name ?? '';
        case 'min': return p._min ?? null;
        case 'pts': return p._pts ?? null;
        case 'reb': return (p._reb === '-' ? null : Number(p._reb));
        case 'asst': return p._asst ?? null;
        case 'num': return p._num ?? null;
        default: return null;
      }
    }
    function compareValues(a, b, key, dir){
      const va = getComparable(a, key), vb = getComparable(b, key);
      let cmp = 0;
      if (va === vb) cmp = 0;
      else if (va === null) cmp = 1;
      else if (vb === null) cmp = -1;
      else if (typeof va === 'number' && typeof vb === 'number') cmp = va - vb;
      else cmp = String(va).localeCompare(String(vb), 'it', {numeric:true});
      return (dir === 'asc') ? cmp : -cmp;
    }
    function renderPlayers(){
      const statsContainer = document.getElementById("players-stats");
      const rows = [...PLAYERS].sort((a,b)=>compareValues(a,b,sortState.key,sortState.dir));
      statsContainer.innerHTML = rows.map(p => `
        <div class="stats-row">
          <div class="stat-name">
            <span class="badge-num">#${fmt(p.Number)}</span>
            <span>${p._name}</span>
          </div>
          <div class="stat">${fmt(p.min)}</div>
          <div class="stat">${fmt(p.pts)}</div>
          <div class="stat">${p._reb}</div>
          <div class="stat">${fmt(p.asst)}</div>
        </div>
      `).join('');
      updateHeaderIndicators();
    }
    function setupSortingUI(){
      const header = document.getElementById('stats-header');
      header.querySelectorAll('[data-key]').forEach(el => {
        el.addEventListener('click', () => handleSortClick(el.getAttribute('data-key')));
        el.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handleSortClick(el.getAttribute('data-key')); }
        });
      });
    }
    function handleSortClick(key){
      if (sortState.key === key) sortState.dir = (sortState.dir === 'asc') ? 'desc' : 'asc';
      else { sortState.key = key; sortState.dir = (key === 'name') ? 'asc' : 'desc'; }
      renderPlayers();
    }
    function updateHeaderIndicators(){
      const header = document.getElementById('stats-header');
      header.querySelectorAll('[data-key]').forEach(el => {
        const k = el.getAttribute('data-key');
        const span = el.querySelector('.sort-indicator');
        if (k === sortState.key) { span.textContent = (sortState.dir === 'asc') ? '▲' : '▼'; span.style.opacity = '1'; }
        else { span.textContent = ''; span.style.opacity = '.4'; }
      });
    }

    /* ---------- Riepilogo squadre (barre proporzionali) ---------- */
    function renderSummaryCard(){
      const rp = document.getElementById('right-panel');
      if (!TEAM_A && !TEAM_B) return;

      const ptsA = toNum(TEAM_A?.pts), ptsB = toNum(TEAM_B?.pts);

      const fgPA = toNum(TEAM_A?.['fg%']) ?? pctFromMadeAtt(TEAM_A?.fg);
      const fgPB = toNum(TEAM_B?.['fg%']) ?? pctFromMadeAtt(TEAM_B?.fg);
      const t3PA = toNum(TEAM_A?.['3pt%']) ?? pctFromMadeAtt(TEAM_A?.['3pt']);
      const t3PB = toNum(TEAM_B?.['3pt%']) ?? pctFromMadeAtt(TEAM_B?.['3pt']);
      const ftPA = toNum(TEAM_A?.['ft%']) ?? pctFromMadeAtt(TEAM_A?.ft);
      const ftPB = toNum(TEAM_B?.['ft%']) ?? pctFromMadeAtt(TEAM_B?.ft);

      const REB_A = (sumReb(TEAM_A ?? {}) === '-' ? null : Number(sumReb(TEAM_A ?? {})));
      const REB_B = (sumReb(TEAM_B ?? {}) === '-' ? null : Number(sumReb(TEAM_B ?? {})));
      const AST_A = toNum(TEAM_A?.asst), AST_B = toNum(TEAM_B?.asst);
      const STL_A = toNum(TEAM_A?.stl),  STL_B = toNum(TEAM_B?.stl);
      const TO_A  = toNum(TEAM_A?.to),   TO_B  = toNum(TEAM_B?.to);

      function shares(aVal, bVal){
        const a = (aVal ?? 0), b = (bVal ?? 0);
        const tot = a + b;
        return (tot > 0) ? { a: (a/tot)*100, b: (b/tot)*100 } : { a:0, b:0 };
      }
      function metricHTML(label, aVal, bVal, isPercent=false){
        const s = shares(aVal, bVal);
        const aText = (aVal == null) ? '-' : (isPercent ? `${aVal.toFixed(0)}%` : `${aVal}`);
        const bText = (bVal == null) ? '-' : (isPercent ? `${bVal.toFixed(0)}%` : `${bVal}`);
        return `
          <div class="metric">
            <div class="label">${label}</div>
            <div class="bars" aria-hidden="true">
              <div class="bar bar-a" style="width:${s.a.toFixed(0)}%"></div>
              <div class="bar bar-b" style="width:${s.b.toFixed(0)}%"></div>
            </div>
            <div class="value">${aText} · ${bText}</div>
          </div>
        `;
      }

      const card = document.createElement('div');
      card.className = 'summary-card';
      card.innerHTML = `
        <div class="summary-header">
          <div class="summary-team">
            <span class="team-badge">${initials(NAME_A)}</span>
            <span class="summary-team-name">${NAME_A}</span>
          </div>
          <div class="summary-score">${(ptsA ?? '-')} - ${(ptsB ?? '-')}</div>
          <div class="summary-team" style="justify-content:flex-end">
            <span class="summary-team-name" style="text-align:right">${NAME_B}</span>
            <span class="team-badge">${initials(NAME_B)}</span>
          </div>
        </div>
        <div class="hint">Confronto rapido percentuali e conteggi (A sinistra = ${NAME_A}, a destra = ${NAME_B}).
        <div class="summary-grid">
          ${metricHTML('FG%', fgPA, fgPB, true)}
          ${metricHTML('3PT%', t3PA, t3PB, true)}
          ${metricHTML('FT%', ftPA, ftPB, true)}
          ${metricHTML('REB', REB_A, REB_B)}
          ${metricHTML('AST', AST_A, AST_B)}
          ${metricHTML('STL', STL_A, STL_B)}
          ${metricHTML('TO',  TO_A,  TO_B)}
        </div>
      `;
      rp.appendChild(card);
    }

    /* ---------- Estrazione data partita (prefisso YYYYMMDD) ---------- */
    function extractDatePrefixFromMatchData(dataArray) {
      // Cerca prima un valore che contenga 8 cifre consecutive (YYYYMMDD)
      const flatValues = dataArray.flatMap(obj => Object.values(obj).map(v => String(v || '')));
      for (const v of flatValues) {
        const m = v.match(/(20\d{6})/);
        if (m) return m[1];
      }
      // Cerca campo 'Data' o 'Date' e prova a parsare
      const candidate = dataArray.find(obj => Object.keys(obj).some(k => ['data','date','Data','Date'].includes(k)));
      if (candidate) {
        const key = Object.keys(candidate).find(k => ['data','date','Data','Date'].includes(k));
        const raw = String(candidate[key] || '');
        const parsed = parseItalianDate(raw);
        if (parsed) return parsedToYYYYMMDD(parsed);
      }
      // prova a cercare in righe metadata dei team
      const teamRow = dataArray.find(obj => String(obj['Player ID'] || '').toLowerCase().includes('brewers')) || dataArray[0];
      for (const k of Object.keys(teamRow || {})) {
        const val = String(teamRow[k] || '');
        const m = val.match(/(20\d{6})/);
        if (m) return m[1];
        const pd = parseItalianDate(val);
        if (pd) return parsedToYYYYMMDD(pd);
      }
      return null;
    }

    function parsedToYYYYMMDD(d) {
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      return `${yyyy}${mm}${dd}`;
    }

    function parseItalianDate(str) {
      if (!str) return null;
      // rimuovi day-of-week e testi extra
      let s = str.trim().toLowerCase();
      s = s.replace(/\(.*?\)/g,'').replace(/[,]/g,' ').replace(/\s+/g,' ').trim();
      // replace month names italian -> english month number
      const months = {
        'gennaio':1,'febbraio':2,'marzo':3,'aprile':4,'maggio':5,'giugno':6,
        'luglio':7,'agosto':8,'settembre':9,'ottobre':10,'novembre':11,'dicembre':12,
        'ago':8,'set':9,'ott':10,'nov':11,'dic':12
      };
      // match patterns like "9 ottobre 2025" or "9/10/2025" or "2025-10-09"
      let m;
      if (m = s.match(/(\d{1,2})\s+([a-zàèé]+)\s+(\d{4})/i)) {
        const day = Number(m[1]), monName = m[2], year = Number(m[3]);
        const mon = months[monName.toLowerCase()];
        if (mon) return new Date(year, mon-1, day);
      }
      if (m = s.match(/(\d{1,2})[\/\-.](\d{1,2})[\/\-.](\d{4})/)) {
        const day = Number(m[1]), mon = Number(m[2]), year = Number(m[3]);
        return new Date(year, mon-1, day);
      }
      if (m = s.match(/(\d{4})[\/\-.](\d{1,2})[\/\-.](\d{1,2})/)) {
        const year = Number(m[1]), mon = Number(m[2]), day = Number(m[3]);
        return new Date(year, mon-1, day);
      }
      // prova a trovare un 8-digit YYYYMMDD in stringa
      if (m = s.match(/(20\d{6})/)) {
        const y = Number(m[1].slice(0,4)), mo = Number(m[1].slice(4,6)), dday = Number(m[1].slice(6,8));
        return new Date(y, mo-1, dday);
      }
      return null;
    }

    /* ---------- Caricamento articoli_per_news e rendering card ---------- */
    async function renderArticleVideoCards(datePrefix) {
      try {
        // richiede la lista contenuti tramite GitHub API (public repo)
        const apiUrl = 'https://api.github.com/repos/sverza/Brewers/contents/articoli_per_news';
        const res = await fetch(apiUrl);
        if (!res.ok) return; // se non riesce, non mostriamo nulla
        const files = await res.json();
        if (!Array.isArray(files) || files.length === 0) return;

        // filtra i file che iniziano con il prefisso
        const matches = files
          .filter(f => typeof f.name === 'string' && f.name.toLowerCase().startsWith(datePrefix.toLowerCase()))
          .sort((a,b) => (a.name < b.name ? 1 : -1)); // ordine decrescente per nome

        if (matches.length === 0) return;

        // prendi il primo file corrispondente
        const file = matches[0];
        // scarica il JSON
        const downloadUrl = file.download_url;
        const fRes = await fetch(downloadUrl);
        if (!fRes.ok) return;
        const articleJson = await fRes.json();

        // costruisci le card e appendi al right-panel sotto il riepilogo
        const rp = document.getElementById('right-panel');
        const container = document.createElement('div');
        container.className = 'foot-cards';

        // SVG icons (inline)
        const svgArticle = `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <rect x="3" y="3" width="14" height="18" rx="2" stroke="currentColor" stroke-width="1.6" fill="none"/>
          <path d="M7 7h6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
          <path d="M7 11h8" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
          <path d="M7 15h6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
        </svg>`;

        const svgYoutube = `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M23.5 7.2c-.2-1.6-1.6-2.9-3.2-3.1C18.6 3.7 12 3.7 12 3.7s-6.6 0-8.3.4C2.1 4.3.7 5.6.5 7.2.1 9.2.1 12 .1 12s0 2.8.4 4.8c.2 1.6 1.6 2.9 3.2 3.1 1.7.4 8.3.4 8.3.4s6.6 0 8.3-.4c1.6-.2 3-1.5 3.2-3.1.4-2 .4-4.8.4-4.8s0-2.8-.4-4.8z" stroke="currentColor" stroke-width="0.6" fill="currentColor"/>
          <path d="M10 15l5-3-5-3v6z" fill="#fff"/>
        </svg>`;

        // Card Articolo -> link alla pagina article_view.html?articolo=[nome_senza_.json]
        const articleSlug = file.name.replace(/\.json$/i, '');
        const articleCard = document.createElement('a');
        articleCard.className = 'news-card';
        articleCard.href = `https://brewersbasketball.it/article_view.html?articolo=${encodeURIComponent(articleSlug)}`;
        articleCard.target = '_blank';
        articleCard.rel = 'noopener';

        const imgName = (articleJson.img_name || '').replace(/\.(jpg|jpeg|png|gif)$/i, '');
        const thumbText = (imgName.match(/^(\d{8})/) ? imgName.substring(0,8) : (articleJson.title || '').slice(0,3)).toUpperCase();

        articleCard.innerHTML = `
          <div class="news-thumb" aria-hidden="true">${svgArticle}</div>
          <div class="news-body">
            <div class="news-title">${escapeHtml(articleJson.title || 'Articolo')}</div>
            <div class="news-desc">${escapeHtml(articleJson.short_description || '')}</div>
          </div>
          <div class="news-cta"><span class="btn">Leggi</span></div>
        `;
        container.appendChild(articleCard);

        // Card Video -> link al video_url presente nel JSON (se esiste)
        if (articleJson.video_url) {
          const videoCard = document.createElement('a');
          videoCard.className = 'news-card';
          videoCard.href = articleJson.video_url;
          videoCard.target = '_blank';
          videoCard.rel = 'noopener';

          videoCard.innerHTML = `
            <div class="news-thumb" aria-hidden="true">${svgYoutube}</div>
            <div class="news-body">
              <div class="news-title">Video: ${escapeHtml(articleJson.title || '')}</div>
              <div class="news-desc">Guarda il video della partita su YouTube</div>
            </div>
            <div class="news-cta"><span class="btn">Guarda</span></div>
          `;
          container.appendChild(videoCard);
        }

        rp.appendChild(container);
      } catch (e) {
        // non critico: se qualcosa fallisce, non mostriamo nulla (log in console per debug)
        console.debug('renderArticleVideoCards error', e);
      }
    }

    function escapeHtml(str) {
      if (!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

  </script>
</body>
</html>
