<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Brewers Basket Milano</title>
<style>
@font-face {
  font-family: 'Strike Fighter Laser';
  src: url('https://raw.githubusercontent.com/sverza/Brewers/main/Font/strikefighterlaser.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
  width: 100%; height: 100%;
  overflow-x: hidden;
  background: #090909;
  font-family: 'Segoe UI', sans-serif;
}

#main-container { display: flex; flex-direction: column; align-items: stretch; width: 100%; min-height: 100vh; padding: 0 5px; background: #090909; }
#header-container { position: sticky; top: 0; z-index: 1000; background-color: #090909; width: 100%; }

/* ===== Header/menu base ===== */
.brewers-header { width: 100%; max-width: 1130px; margin: 0 auto; padding: 1rem; display: flex; flex-wrap: wrap; align-items: center; gap: 1rem; }
.brewers-logo-link { display: flex; align-items: center; text-decoration: none; }
.brewers-logo-link img { width: 80px; height: auto; flex-shrink: 0; }
.brewers-title { font-family: 'Strike Fighter Laser', sans-serif; font-size: clamp(24px, 6vw, 32px); color: white; margin-left: 0.5rem; }

.brewers-menu { display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; align-items: center; margin-left: auto; }
.brewers-menu button {
  font-family: 'Strike Fighter Laser', sans-serif; font-size: 1.1rem; color: white; background: none; border: none; cursor: pointer; padding: 0.5rem 0.75rem; transition: background-color 0.2s;
}
.brewers-menu button:hover { background-color: rgba(255, 255, 255, 0.1); border-radius: 4px; }

/* ===== Marquee ===== */
#marquee-wrapper { background-color: #111; overflow: hidden; white-space: nowrap; padding: 0.7rem 0; border-top: 2px solid #f39c12; border-bottom: 2px solid #f39c12; }
#marquee-content { display: inline-block; padding-left: 100%; animation: scroll-left 14s linear infinite; font-family: 'Bebas Neue', sans-serif; color: white; font-size: 1.4rem; letter-spacing: 1.5px; text-shadow: 0 0 5px rgba(255, 255, 255, 0.1); transition: animation-play-state 0.3s; }
#marquee-wrapper:hover #marquee-content { animation-play-state: paused; }
#marquee-content .highlight { color: #f39c12; text-shadow: 0 0 8px rgba(243, 156, 18, 0.5); }
@keyframes scroll-left { 0%{transform: translateX(0%);} 100%{transform: translateX(-100%);} }

/* ===== Hero image ===== */
.image-section { position: relative; width: 100%; max-width: 1130px; margin: 40px auto 20px; }
.image-section img { width: 100%; height: auto; display: block; opacity: 0.6; }
.image-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; font-family: 'Strike Fighter Laser', sans-serif; font-size: clamp(24px, 6vw, 72px); font-weight: 400; line-height: 1.2; color: #FEC3C7; }
.image-text span:nth-child(2){ color: #9AD7F3; }
.image-text span:nth-child(3){ color: #6BDFDA; }

.bottom-bar { display: none; }

/* ===== Eventi ===== */
.events-section { display: flex; flex-wrap: wrap; justify-content: space-between; gap: 2rem; width: 100%; max-width: 1400px; margin: 2rem auto; padding: 0 1rem; }
.event-block { flex: 1 1 min(48%, 700px); max-width: 100%; display: flex; flex-direction: column; gap: 1.5rem; }
@media (max-width: 768px) { .event-block { flex: 1 1 100%; max-width: 100%; } }
.event-title { font-family: 'Strike Fighter Laser', sans-serif; font-size: clamp(22px, 3vw, 28px); color: white; text-align: center; margin-bottom: 0.5rem; }

/* ===== Big card ===== */
.big-card { position: relative; height: 280px; border-radius: 12px; overflow: hidden; font-family: 'Inter', sans-serif; color: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.35); }
.big-card img { width: 100%; height: 100%; object-fit: cover; object-position: center; display: block; filter: brightness(0.6) contrast(1.02); }

.big-card-info {
  position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: flex-end;
  padding: 1.1rem 11rem 1.1rem 1rem; background: linear-gradient(180deg, rgba(0,0,0,0) 35%, rgba(0,0,0,0.45) 70%, rgba(0,0,0,0.75) 100%);
}
.big-card-info .event-date{ font-size: .95rem; line-height: 1.3; color:#eaf6ff; opacity:.95; margin: 0 0 .4rem 0; }
.big-card-info .event-name{ font-size: 1.25rem; font-weight: 800; line-height: 1.3; color:#fff; margin: 0 0 .4rem 0; }
.big-card-info .event-location{ font-size: .95rem; line-height: 1.3; color:#eaf6ff; opacity:.95; margin: 0 0 .6rem 0; }

.event-name-with-score{ display:flex; justify-content:flex-start; align-items:center; gap:.5rem; font-size:1.1rem; font-weight:800; margin:0; }
.event-name-with-score .event-name{ color:#fff; }
.event-result{ display:flex; align-items:center; gap:.4rem; }
.result-letter{ font-weight:700; font-size:.95rem; padding:2px 6px; border-radius:4px; line-height:1; }
.result-letter.win{ color:#21aa64; background: rgba(0,230,118,.15); }
.result-letter.loss{ color:#ff5252; background: rgba(255,82,82,.15); }
.result-score{ font-weight:700; color:#fff; }

/* punteggio + bottone fissati in basso a destra */
.big-card .event-result-wrapper{
  position: absolute; right: 1rem; bottom: 1rem;
  display: flex; flex-direction: column; align-items: flex-end; gap: .5rem;
}
.invisible-placeholder{ visibility: hidden; }
@media (max-width: 520px){ .big-card-info{ padding-right: 8.5rem; } }

/* ===== Small cards (icone + testo + punteggio a destra) ===== */
.small-card {
  display: grid;
  grid-template-columns: 89px 1fr auto;    /* thumb | info | score right */
  gap: 1rem; align-items: center;
  background-color: #1f1f1f; border-radius: 10px; padding: 0.75rem 1rem;
  font-family: 'Inter', sans-serif; color: #d9d9d9; box-shadow: 0 3px 6px rgba(0,0,0,0.2);
}
.small-card .thumb { width: 89px; height: 84px; border-radius: 10px; background: #111; display:flex; align-items:center; justify-content:center; overflow:hidden; }
.small-card .thumb svg { width: 70px; height: 70px; }

.small-card-info { display: flex; flex-direction: column; gap: 0.3rem; min-width: 0; }
.small-card-info .event-date { font-size: 0.75rem; color: #cdd7e1; }
.small-card-info .event-name { font-size: 1rem; font-weight: 700; color: #ffffff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.small-card-info .event-location { font-size: 0.85rem; color: #32ADE6; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

.small-card .score-right { justify-self: end; display:flex; align-items:center; gap:.45rem; min-width: 72px; text-align: right; }
.small-card .score-right .event-result{ justify-content:flex-end; }

/* ======= Award Banner (dinamico) ======= */
.award-banner { width: 100%; }
.award-wrap { max-width: 1130px; margin: 14px auto 12px; padding: 0 0; }
.award-card{
  position: relative; overflow: hidden; border-radius: 16px; border: 1px solid rgba(102,252,241,0.18);
  background:
    radial-gradient(120% 120% at 0% 0%, rgba(102,252,241,0.10), transparent 55%),
    radial-gradient(120% 120% at 100% 100%, rgba(154,215,243,0.10), transparent 55%),
    linear-gradient(180deg, #0f1115 0%, #0c0e12 100%);
  box-shadow: 0 12px 28px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.05);
  display: grid; grid-template-columns: auto 1fr; align-items: center; gap: 1rem;
  padding: clamp(12px, 2vw, 18px) clamp(14px, 2.5vw, 22px); isolation: isolate;
}
.award-card::before{ content:''; position:absolute; inset:-2px; background: linear-gradient(90deg, transparent, rgba(102,252,241,0.25), transparent); transform: translateX(-100%); animation: sheen 4.6s linear infinite; pointer-events: none; z-index: 0; }
@keyframes sheen { to { transform: translateX(100%); } }
.award-medal{ position: relative; z-index: 1; width: clamp(56px, 7vw, 74px); height: clamp(56px, 7vw, 74px); border-radius: 50%;
  background: radial-gradient(circle at 35% 35%, #f0f2f5, #d8dde3 45%, #aeb5be 65%, #f4f6f8 100%); box-shadow: inset 0 2px 10px rgba(0,0,0,0.25), 0 6px 22px rgba(0,0,0,0.35);
  display:flex; align-items:center; justify-content:center; }
.award-medal span{ font-size: clamp(22px, 3vw, 28px); filter: drop-shadow(0 2px 2px rgba(0,0,0,0.35)); }
.award-title{ z-index: 1; font-family: 'Strike Fighter Laser', sans-serif; font-size: clamp(18px, 3.3vw, 30px); line-height: 1.15; color: #e8eef2; letter-spacing: 0.5px; text-wrap: balance; }
.award-title .accent{ color:#66fcf1; text-shadow: 0 0 10px rgba(102,252,241,0.25); }
.award-title .silver{ background: linear-gradient(180deg, #f7f9fc 0%, #dfe4ea 35%, #b8c0c8 60%, #eef2f5 100%); -webkit-background-clip: text; background-clip: text; color: transparent; text-shadow: 0 1px 10px rgba(255,255,255,0.05), 0 0 18px rgba(180, 200, 210, 0.25); }
@media (max-width: 700px){ .award-card{ grid-template-columns: 1fr; text-align: center; gap: .75rem; padding: 14px 14px; } .award-medal{ margin: 0 auto; } }

/* ===== News ===== */
.news-section { padding: 2rem 1rem; max-width: 1130px; margin: 0 auto; }
.news-title { font-family: 'Strike Fighter Laser', sans-serif; font-size: clamp(22px, 3vw, 32px); color: white; text-align: center; margin-bottom: 1.5rem; }
.news-cards { display: flex; flex-wrap: wrap; gap: 2rem; justify-content: center; }
.news-card { background-color: #1f1f1f; border-radius: 10px; width: 100%; max-width: 330px; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 4px 10px rgba(0,0,0,0.2); font-family: 'Inter', sans-serif; }
.news-card img { width: 100%; height: 200px; object-fit: cover; object-position: center center; display: block; }
.news-card-content { padding: 1rem; display: flex; flex-direction: column; flex-grow: 1; justify-content: space-between; gap: 1rem; }
.news-title-text { font-size: 1.1rem; font-weight: bold; color: #ffffff; margin-bottom: 0.25rem; }
.news-subtitle { font-size: 0.9rem; color: #d9d9d9; margin-bottom: 1rem; }

/* ===== Buttons ===== */
.btn-brewers {
  font-family: 'Strike Fighter Laser', sans-serif; font-size: 1rem;
  display: inline-flex; align-items: center; justify-content: center;
  padding: 0.55rem 1.1rem; border-radius: 10px; border: 1px solid rgba(0,0,0,0.08);
  background: #66fcf1; color: #0b0c10; cursor: pointer;
  box-shadow: 0 6px 14px rgba(154,215,243,0.18), inset 0 1px 0 rgba(255,255,255,0.35);
  transition: transform .15s ease, background-color .2s ease, box-shadow .2s ease, filter .2s ease; text-decoration: none;
}
.btn-brewers:hover { background: #6bbfd8; box-shadow: 0 8px 18px rgba(107,191,216,0.28), inset 0 1px 0 rgba(255,255,255,0.4); transform: translateY(-1px); }
.btn-brewers:active { transform: translateY(0); filter: brightness(0.98); }
.btn-brewers:focus { outline: 2px solid #66fcf1; outline-offset: 2px; }

/* ===== Features ===== */
.features-section{ background: radial-gradient(circle at top center, rgba(0, 255, 255, 0.06) 0%, #0b0c10 100%); padding: 4rem 0 4.5rem; }
.features-wrap{ max-width: 1280px; margin: 0 auto; padding: 0 1rem; }
.features-grid{ display: flex; flex-wrap: wrap; gap: 1.5rem; justify-content: center; align-items: stretch; }
.feature-card{ flex: 1 1 clamp(280px, 30%, 360px); max-width: 360px; min-width: 280px; position: relative; overflow: hidden; border-radius: 16px; border: 1px solid rgba(102,252,241,0.12); background: #121416; box-shadow: 0 6px 18px rgba(0,0,0,0.35); min-height: 280px; display: flex; flex-direction: column; justify-content: flex-end; isolation: isolate; transform: translateZ(0); }
@media (min-width: 1280px){ .feature-card{ flex-basis: clamp(280px, 22%, 360px); } }
@media (max-width: 900px){
  .features-section{ overflow: hidden; }
  .features-grid{ flex-wrap: nowrap; overflow-x: auto; overflow-y: hidden; padding: 0 1rem 0.5rem; gap: 1rem; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }
  .features-grid::-webkit-scrollbar{ height: 8px; } .features-grid::-webkit-scrollbar-thumb{ background:#00aaff; border-radius:4px; } .features-grid::-webkit-scrollbar-track{ background:#222; }
  .feature-card{ flex: 0 0 85%; max-width: 85%; min-width: 85%; scroll-snap-align: center; scroll-snap-stop: always; margin: 0; }
}
.feature-card::before{ content:''; position:absolute; inset:0; background-size: cover; background-position: center; filter: grayscale(70%) brightness(0.85); transform: scale(1.02); transition: transform .45s ease, filter .45s ease; z-index:0; }
.feature-card::after{ content:''; position:absolute; inset:0; background: linear-gradient(180deg, rgba(11,12,16,0.05) 0%, rgba(11,12,16,0.35) 45%, rgba(11,12,16,0.82) 100%); z-index:0; }
.feature-content{ position: relative; z-index:1; padding: 1.25rem 1.25rem 1.1rem; display:flex; flex-direction:column; gap:.55rem; }
.feature-title{ color:#66fcf1; font-size:1.2rem; line-height:1.2; }
.feature-desc{ color:#c5c6c7; font-size:.98rem; max-width: 60ch; }
.feature-actions{ margin-top:.4rem; }
@media (hover:hover) and (pointer:fine){ .feature-card:hover::before{ transform: scale(1.08); filter: grayscale(0%) brightness(1); } .feature-card:hover{ box-shadow: 0 14px 26px rgba(69,162,158,0.35); } .features-grid:has(.feature-card:hover) .feature-card:not(:hover){ filter: saturate(0.9) opacity(0.88); } }
.card--team::before{ background-image:url('../articoli_per_news/images/art_1.jpeg'); }
.card--articles::before{ background-image:url('../articoli_per_news/images/20250411_@FortitudoCeriano.jpg'); }
.card--partners::before{ background-image:url('../articoli_per_news/images/20250117_VSBasketPaderno.jpg'); }
.reveal{ opacity: 0; transform: translateY(24px); transition: opacity .6s ease, transform .6s ease; }
.reveal.in-view{ opacity:1; transform: translateY(0); }
.features-dots{ display: none; }
@media (max-width: 900px){ .features-dots{ display: flex; justify-content: center; align-items: center; gap: .5rem; margin-top: 1rem; } .features-dots .dot{ width: 8px; height: 8px; border-radius: 50%; background: #3b4a50; border: 1px solid rgba(102,252,241,0.35); transform: scale(1); transition: transform .2s ease, background-color .2s ease, opacity .2s ease; opacity: .7; cursor: pointer; } .features-dots .dot.active{ background: #9AD7F3; transform: scale(1.4); opacity: 1; } }
@media (prefers-reduced-motion: reduce){ .reveal{ transition: none; opacity:1; transform:none; } .feature-card::before{ transition:none; }
}
</style>
</head>
<body>
<div id="main-container">
  <div id="header-container"></div>

  <div id="marquee-wrapper"><div id="marquee-content"></div></div>

  <div class="image-section">
    <img src="../images/20250525_VSMassalengoOrange-Photoroom_bw.png" alt="Basket Group Beers" />
    <div class="image-text">
      <span>Basket<br /></span>
      <span>Group<br /></span>
      <span>Beers</span>
    </div>
  </div>

  <!-- ===== Sezione Eventi (dinamica) ===== -->
  <div class="events-section">
    <div class="event-block">
      <div class="event-title">Ultime Partite</div>
      <div id="past-dynamic"></div>
    </div>

    <div class="event-block">
      <div class="event-title">Prossimi Eventi</div>
      <div id="future-dynamic"></div>
    </div>
  </div>

  <!-- ===== Award Banner (dinamico) ===== -->
  <section class="award-banner" aria-label="Brewers — Ultima e Prossima">
    <div class="award-wrap">
      <div class="award-card">
        <div class="award-medal" aria-hidden="true"><span>🏀</span></div>
        <h2 class="award-title" id="award-dynamic-title">
          <span class="accent">Brewers</span> — caricamento in corso…
        </h2>
      </div>
    </div>
  </section>

  <!-- ===== News ===== -->
  <div class="news-section">
    <div class="news-title">Ultime News</div>
    <div class="news-cards" id="news-cards"><!-- Popolate in automatico --></div>
  </div>

  <!-- ===== Features ===== -->
  <section class="features-section">
    <div class="news-title">Vuoi Saperne di Più?</div>
    <div class="features-wrap">
      <div class="features-grid" id="featuresGrid">
        <article class="feature-card card--team reveal">
          <div class="feature-content">
            <h3 class="feature-title">La Squadra</h3>
            <p class="feature-desc">Vuoi conoscere i nostri Brewers? Sei nel posto giusto!</p>
            <div class="feature-actions"><button class="btn-brewers" onclick="location.href='https://brewersbasketball.it/roster.html'">Scopri</button></div>
          </div>
        </article>
        <article class="feature-card card--articles reveal">
          <div class="feature-content">
            <h3 class="feature-title">Articoli</h3>
            <p class="feature-desc">Tutta la rassegna stampa dei nostri bevitori... o giocatori!</p>
            <div class="feature-actions"><button class="btn-brewers" onclick="location.href='https://brewersbasketball.it/article_list.html?page=1'">Vai</button></div>
          </div>
        </article>
        <article class="feature-card card--partners reveal">
          <div class="feature-content">
            <h3 class="feature-title">Partner</h3>
            <p class="feature-desc">Vuoi conoscere i nostri sponsor, partner e amici? O ancora meglio.. vuoi collaborare con noi?</p>
            <div class="feature-actions"><button class="btn-brewers" onclick="location.href='https://brewersbasketball.it/contatti.html'">Contattaci</button></div>
          </div>
        </article>
      </div>
      <div class="features-dots" id="featuresDots" aria-label="Paginazione carosello"></div>
    </div>
  </section>

  <div id="footer-container"></div>
</div>

<script>
// Footer
fetch('https://raw.githubusercontent.com/sverza/Brewers/main/widget/brewers_footer.html')
  .then(r => { if(!r.ok) throw new Error('Errore nel caricamento del footer'); return r.text(); })
  .then(html => { document.getElementById('footer-container').innerHTML = html; })
  .catch(err => console.error('Errore:', err));

// Header
fetch('https://raw.githubusercontent.com/sverza/Brewers/main/widget/brewers_header.html')
  .then(r => { if(!r.ok) throw new Error('Errore nel caricamento dell header'); return r.text(); })
  .then(html => {
    document.getElementById('header-container').innerHTML = html;
    const icon = document.getElementById("menu-icon");
    const iconFixed = document.getElementById("menu-icon-fixed");
    const menu = document.getElementById("brewers-menu");
    const overlay = document.getElementById("menu-overlay");
    function toggleMenu() {
      const isOpening = !menu.classList.contains("open");
      menu.classList.toggle("open");
      overlay.classList.toggle("active");
      icon.classList.add("bounce");
      iconFixed.classList.add("bounce");
      setTimeout(()=>{ icon.classList.remove("bounce"); iconFixed.classList.remove("bounce"); },500);
      if (isOpening) setTimeout(()=>{ iconFixed.style.display = "block"; },300);
      else iconFixed.style.display = "none";
    }
    icon.addEventListener("click", toggleMenu);
    iconFixed.addEventListener("click", toggleMenu);
    overlay.addEventListener("click", ()=>{ menu.classList.remove("open"); overlay.classList.remove("active"); iconFixed.style.display = "none"; });
  })
  .catch(err => console.error('Errore:', err));

/* ====== CONFIG CALENDARIO ====== */
const JSON_PATH = 'partite/calendario.json';
const TEAM_NAME = 'BREWERS';
const MAX_PAST_SMALL = 2;
const MAX_FUT_SMALL = 2;

const MONTHS_IT = { 'gennaio':1,'febbraio':2,'marzo':3,'aprile':4,'maggio':5,'giugno':6,'luglio':7,'agosto':8,'settembre':9,'ottobre':10,'novembre':11,'dicembre':12 };
const MONTHS_IT_ABBR = ['gen','feb','mar','apr','mag','giu','lug','ago','set','ott','nov','dic'];
const WEEKDAYS_IT_ABBR = ['dom','lun','mar','mer','gio','ven','sab'];

function pad2(n){ n = parseInt(n,10); return (n<10? '0':'') + n; }
function fixTimeString(raw){
  if(!raw) return '00:00:00';
  let s = String(raw).replace(/[^0-9:]/g,'');
  if(/^\d{1,2}:\d{2}(:\d{2})?$/.test(s)){ const p = s.split(':'); if(p.length===2) return `${pad2(p[0])}:${p[1]}:00`; return `${pad2(p[0])}:${p[1]}:${p[2]}`; }
  const only = s.replace(/:/g,'');
  if(/^\d{3,6}$/.test(only)){ if(only.length===4) return `${only.slice(0,2)}:${only.slice(2)}:00`; if(only.length===6) return `${only.slice(0,2)}:${only.slice(2,4)}:${only.slice(4,6)}`; }
  return '00:00:00';
}
function parseItalianDate(dateStr, timeStr){
  const parts = String(dateStr).toLowerCase().trim().split(/\s+/);
  const day = parseInt(parts[1],10);
  const month = MONTHS_IT[parts[2]] || 1;
  const year = parseInt(parts[3],10);
  const t = fixTimeString(timeStr||'00:00:00');
  const [hh,mm,ss] = t.split(':').map(x=>parseInt(x,10));
  return new Date(year, month-1, day, hh, mm, ss||0);
}
function formatShort(d){ const wd = WEEKDAYS_IT_ABBR[d.getDay()]; const dd = pad2(d.getDate()); const mon = MONTHS_IT_ABBR[d.getMonth()]; const hh = pad2(d.getHours()); const mm = pad2(d.getMinutes()); return `${wd}, ${dd} ${mon} · ${hh}:${mm}`; }

function involvesBrewers(row){ const h = String(row['Squadra Casa']||'').toUpperCase(); const a = String(row['Squadra Trasferta']||'').toUpperCase(); return h.includes(TEAM_NAME) || a.includes(TEAM_NAME); }
function brewersAtHome(row){ const h = String(row['Squadra Casa']||'').toUpperCase(); return h.includes(TEAM_NAME); }
function opponent(row){ return brewersAtHome(row) ? row['Squadra Trasferta'] : row['Squadra Casa']; }
function toDate(row){ return parseItalianDate(row['Data'], row['Ora']); }
function parseScore(v){ if(v==null) return null; const n = parseInt(String(v).replace(/[^0-9-]/g,''),10); return isNaN(n) ? null : n; }
function resultInfo(row){
  const hc = parseScore(row['Punteggio Casa']);
  const ta = parseScore(row['Punteggio Trasferta']);
  if(hc==null || ta==null) return null;
  const brewersHome = brewersAtHome(row);
  const bPts = brewersHome ? hc : ta;
  const oPts = brewersHome ? ta : hc;
  const letter = (bPts>oPts) ? 'W' : (bPts<oPts ? 'L' : 'N');
  return { letter, score: `${hc}–${ta}` };
}
function slugifyTeam(s){ return String(s||'').normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/gi,'').trim(); }
function matchSlug(row){ const d = toDate(row); const yyyy = d.getFullYear(); const mm = pad2(d.getMonth()+1); const dd = pad2(d.getDate()); const home = slugifyTeam(row['Squadra Casa']); const away = slugifyTeam(row['Squadra Trasferta']); return `${yyyy}${mm}${dd}_${home}_${away}`; }

/* SVG icona (inline) per le small-card */
function svgBasketballIcon(){
  return `
  <svg viewBox="0 0 64 64" role="img" aria-label="Icona basket">
    <defs>
      <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0" stop-color="#66fcf1"/><stop offset="1" stop-color="#2eb3ff"/>
      </linearGradient>
    </defs>
    <circle cx="32" cy="32" r="28" fill="none" stroke="url(#g)" stroke-width="4"/>
    <path d="M4 32h56M32 4v56M14 14c12 8 24 28 36 36M50 14c-12 8-24 28-36 36" fill="none" stroke="#a3dfff" stroke-width="2" stroke-linecap="round"/>
  </svg>`;
}

function renderBigCard(row, opts={ future:false }){
  const d = toDate(row);
  const vsLabel = brewersAtHome(row) ? `vs ${opponent(row)}` : `@ ${opponent(row)}`;
  const score = resultInfo(row);
  const btn = !opts.future
    ? `<button class="btn-brewers report-button" onclick="location.href='risultato_partita.html?partita=${matchSlug(row)}'">Vedi Report</button>`
    : `<button class="btn-brewers report-button invisible-placeholder">Vedi Report</button>`;
  const res = (!opts.future && score)
    ? `<span class="event-result"><span class="result-letter ${score.letter==='W'?'win':'loss'}">${score.letter}</span><span class="result-score">${score.score}</span></span>`
    : `<span class="event-result"></span>`;
  const imgFallback = opts.future ? '../articoli_per_news/images/20250215_@FortitudoCeriano.jpg' : '../articoli_per_news/images/20241113_@Peacox_articolo.jpg';
  return `
  <div class="big-card">
    <img src="${imgFallback}" alt="Evento" />
    <div class="big-card-info">
      <div class="event-date">${formatShort(d)}</div>
      <div class="event-name-with-score"><span class="event-name">${vsLabel}</span></div>
      <div class="event-location">${row['Luogo']} · ${row['Indirizzo']}</div>
      <div class="event-result-wrapper">${res}${btn}</div>
    </div>
  </div>`;
}

function renderSmallCard(row, opts={ future:false }){
  const d = toDate(row);
  const vsLabel = brewersAtHome(row) ? `vs ${opponent(row)}` : `@ ${opponent(row)}`;
  const score = resultInfo(row);
  const res = (!opts.future && score)
    ? `<div class="score-right"><span class="event-result"><span class="result-letter ${score.letter==='W'?'win':'loss'}">${score.letter}</span><span class="result-score">${score.score}</span></span></div>`
    : `<div class="score-right"></div>`;
  return `
  <div class="small-card">
    <div class="thumb">${svgBasketballIcon()}</div>
    <div class="small-card-info">
      <div class="event-date">${formatShort(d)}</div>
      <div class="event-name">${vsLabel}</div>
      <div class="event-location">${row['Luogo']}</div>
    </div>
    ${res}
  </div>`;
}

async function loadCalendar(){
  const pastWrap = document.getElementById('past-dynamic');
  const futWrap = document.getElementById('future-dynamic');
  pastWrap.innerHTML = '<div class="small-card"><div class="thumb"></div><div class="small-card-info"><div class="event-name">Caricamento…</div></div><div class="score-right"></div></div>';
  futWrap.innerHTML = '<div class="small-card"><div class="thumb"></div><div class="small-card-info"><div class="event-name">Caricamento…</div></div><div class="score-right"></div></div>';
  try{
    const res = await fetch(JSON_PATH, { cache: 'no-store' });
    if(!res.ok) throw new Error('Impossibile caricare il calendario');
    const data = await res.json();
    const matches = (data||[]).filter(involvesBrewers).sort((a,b)=> toDate(a)-toDate(b));
    const now = new Date();
    const past = matches.filter(m => toDate(m) < now);
    const future = matches.filter(m => toDate(m) >= now);

    // PAST (1 big + MAX_PAST_SMALL small)
    const pastHtml = [];
    if(past.length){
      pastHtml.push( renderBigCard(past[past.length-1], { future:false }) );
      for(let i=2;i>=1 && past.length-1-i>=0 && pastHtml.length-1 < MAX_PAST_SMALL+1;i--){
        pastHtml.push( renderSmallCard(past[past.length-1-i], { future:false }) );
      }
    } else {
      pastHtml.push('<div class="small-card"><div class="thumb"></div><div class="small-card-info"><div class="event-name">Nessuna partita passata.</div></div><div class="score-right"></div></div>');
    }
    pastWrap.innerHTML = pastHtml.join('');

    // FUTURE (1 big + MAX_FUT_SMALL small)
    const futHtml = [];
    if(future.length){
      futHtml.push( renderBigCard(future[0], { future:true }) );
      for(let i=1;i<=MAX_FUT_SMALL && i<future.length;i++){
        futHtml.push( renderSmallCard(future[i], { future:true }) );
      }
    } else {
      futHtml.push('<div class="small-card"><div class="thumb"></div><div class="small-card-info"><div class="event-name">Nessun evento in programma.</div></div><div class="score-right"></div></div>');
    }
    futWrap.innerHTML = futHtml.join('');

    // Marquee + Banner
    buildMarquee(past[past.length-1] || null, future[0] || null);
    buildDynamicBanner(past[past.length-1] || null, future[0] || null);
  }catch(err){
    console.error(err);
    pastWrap.innerHTML = '<div class="small-card"><div class="thumb"></div><div class="small-card-info"><div class="event-name">Errore nel caricamento dati.</div></div><div class="score-right"></div></div>';
    futWrap.innerHTML = '<div class="small-card"><div class="thumb"></div><div class="small-card-info"><div class="event-name">Errore nel caricamento dati.</div></div><div class="score-right"></div></div>';
  }
}

/* Banner dinamico (ultima & prossima) */
function buildDynamicBanner(lastMatch, nextMatch){
  const el = document.getElementById('award-dynamic-title');
  if(!el){ return; }
  const parts = [];
  const fmt = (d)=> formatShort(d);

  if(lastMatch){
    const ri = resultInfo(lastMatch);
    const when = fmt(toDate(lastMatch));
    const label = brewersAtHome(lastMatch) ? `vs ${opponent(lastMatch)}` : `@ ${opponent(lastMatch)}`;
    const score = ri ? ` <span class="silver">${ri.score}</span>` : '';
    const wl = ri ? (ri.letter==='W' ? '✅' : (ri.letter==='L' ? '❌' : '➖')) : '⏱️';
    parts.push(`<span class="accent">Ultima</span>: ${label}${score} · ${when} ${wl}`);
  }
  if(nextMatch){
    const when = fmt(toDate(nextMatch));
    const label = brewersAtHome(nextMatch) ? `vs ${opponent(nextMatch)}` : `@ ${opponent(nextMatch)}`;
    parts.push(`<span class="accent">Prossima</span>: ${label} · ${when} ⚡`);
  }
  el.innerHTML = parts.length ? parts.join('  |  ') : `<span class="accent">Brewers</span> — nessun dato disponibile`;
}

/* Marquee dinamico */
function buildMarquee(lastMatch, nextMatch){
  const marqueeContent = document.getElementById('marquee-content');
  marqueeContent.innerHTML = '';
  const rows = [ '🏀 Welcome to the Brewers Family!' ];
  if(lastMatch){
    const ri = resultInfo(lastMatch);
    const d = formatShort(toDate(lastMatch));
    const v = `${lastMatch['Squadra Casa']} ${ri?ri.score:''} ${lastMatch['Squadra Trasferta']}`;
    rows.push(`🔥 Ultima: ${v} (${d})`);
  }
  if(nextMatch){
    const d = formatShort(toDate(nextMatch));
    const vsLabel = brewersAtHome(nextMatch) ? `vs ${opponent(nextMatch)}` : `@ ${opponent(nextMatch)}`;
    rows.push(`⚡ Prossima: ${vsLabel} (${d})`);
  }
  rows.forEach(text=>{ const span = document.createElement('span'); span.textContent = text; span.style.margin = '0 2rem'; marqueeContent.appendChild(span); });
}

/* ==== Utils articoli ==== */
function dateInfoFromFilename(fname){ const m = (fname || '').match(/^(\d{8})/); if(!m) return null; const raw = m[1]; const y = raw.slice(0,4), mo = raw.slice(4,6), d = raw.slice(6,8); const iso = `${y}-${mo}-${d}`; const ts = new Date(`${iso}T00:00:00`).getTime(); return { iso, ts }; }
function formatDateIT(dateStr){ const d = new Date(dateStr); if(isNaN(d)) return dateStr || ''; return d.toLocaleDateString('it-IT', { year:'numeric', month:'short', day:'2-digit' }); }

/* ==== Ultime News ==== */
const githubApiUrl = 'https://api.github.com/repos/sverza/Brewers/contents/articoli_per_news';
async function fetchLatestNews(){
  const wrap = document.getElementById('news-cards');
  try{
    const res = await fetch(githubApiUrl);
    const data = await res.json();
    const jsonFiles = (data || []).filter(f => f && f.name && f.name.endsWith('.json'));

    const articles = (await Promise.all(jsonFiles.map(async (file)=>{
      try{
        const r = await fetch(file.download_url);
        const j = await r.json();
        const info = dateInfoFromFilename(file.name);
        return {
          title: j.title,
          excerpt: j.short_description,
          dateISO: info ? info.iso : (j.date || ''),
          dateTS: info ? info.ts : (j.date ? new Date(j.date).getTime() : -Infinity),
          image: `articoli_per_news/images/${j.img_name}`,
          link: `article_view.html?articolo=${file.name.replace('.json','')}`,
          filename: file.name
        };
      }catch{ return null; }
    })) ).filter(Boolean)
    .sort((a,b)=> (b.dateTS||-Infinity) - (a.dateTS||-Infinity))
    .slice(0,3);

    if(!articles.length){ wrap.innerHTML = `<div style="color:#c5c6c7">Nessuna news disponibile al momento.</div>`; return; }

    wrap.innerHTML = articles.map(a => `
      <div class="news-card">
        <img src="${a.image}" alt="Anteprima">
        <div class="news-card-content">
          <div class="news-title-text">${a.title}</div>
          <div class="news-subtitle">${a.excerpt || ''}</div>
          <button class="btn-brewers" onclick="location.href='${a.link}'">Leggi</button>
        </div>
      </div>
    `).join('');
  }catch(err){
    console.error('Ultime News:', err);
    wrap.innerHTML = `<div style="color:#c5c6c7">Impossibile caricare le news.</div>`;
  }
}

/* Reveal animazioni */
const toReveal = document.querySelectorAll('.reveal');
const io = new IntersectionObserver((entries) => {
  entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('in-view'); io.unobserve(entry.target); } });
},{ threshold: 0.22 });
toReveal.forEach(el => io.observe(el));

/* Carosello mobile */
(function(){
  const grid = document.getElementById('featuresGrid');
  const dotsWrap = document.getElementById('featuresDots');
  if (!grid || !dotsWrap) return;

  const mm = window.matchMedia('(max-width: 900px)');
  let cards = []; let rafId = null; let scrollEndTimer = null;

  function centerOn(index){
    if (!cards.length) return;
    index = Math.max(0, Math.min(index, cards.length - 1));
    const el = cards[index];
    const left = el.offsetLeft + el.offsetWidth/2 - grid.clientWidth/2;
    grid.scrollTo({ left, behavior: 'smooth' });
  }
  function setActiveDot(index){ const dots = dotsWrap.querySelectorAll('.dot'); dots.forEach((d,i)=> d.classList.toggle('active', i===index)); }
  function computeActive(){
    const center = grid.scrollLeft + grid.clientWidth/2;
    let best = 0, bestDist = Infinity;
    cards.forEach((el,i)=>{ const cardCenter = el.offsetLeft + el.offsetWidth/2; const dist = Math.abs(cardCenter - center); if (dist < bestDist){ bestDist = dist; best = i; } });
    setActiveDot(best); return best;
  }
  function onScroll(){
    if (rafId) cancelAnimationFrame(rafId);
    rafId = requestAnimationFrame(computeActive);
    clearTimeout(scrollEndTimer);
    scrollEndTimer = setTimeout(()=>{ const best = computeActive(); centerOn(best); }, 120);
  }
  function buildDots(){
    dotsWrap.innerHTML = '';
    cards.forEach((_, i)=>{ const b = document.createElement('button'); b.className = 'dot' + (i===0 ? ' active' : ''); b.setAttribute('aria-label', `Vai alla card ${i+1}`); b.addEventListener('click', ()=> centerOn(i)); dotsWrap.appendChild(b); });
  }
  function enableMobile(){ cards = Array.from(grid.querySelectorAll('.feature-card')); if (!cards.length) return; buildDots(); setActiveDot(0); grid.addEventListener('scroll', onScroll, { passive: true }); }
  function disableMobile(){ grid.removeEventListener('scroll', onScroll); dotsWrap.innerHTML = ''; }
  function handleMode(e){ if (e.matches){ enableMobile(); } else { disableMobile(); } }
  handleMode(mm); mm.addEventListener('change', handleMode);
})();

/* Kickoff */
fetchLatestNews();
loadCalendar();
</script>
</body>
</html>
